\version "2.24.4"


\include "../Handpan.ily"
\include "test-functions.ily"

%----------------------------------------
% 正常系テスト
%----------------------------------------
#(test-ok
  parse-block
  `(
    ;; 基本ケース
    ((("a" "b" "]" "x" "y") "]" ())          . (("a" "b") . ("x" "y")))
    ;; 禁止トークンが存在しない場合は通る
    ((("c" "d" ">" "z") ">" ("!"))           . (("c" "d") . ("z")))
    ;; ブロック内が空
    ((("]" "rest") "]" ())                   . (() . ("rest")))
    ;; end-token が最初に出る
    (((">" "more") ">" ())                   . (() . ("more")))
    ;; 残りトークンなしで終了
    ((("1" "2" "]") "]" ())                  . (("1" "2") . ()))
  )
)

%----------------------------------------
% 異常系テスト
%----------------------------------------
#(test-error
  parse-block
  '(
    ;; 閉じ記号がない
    (("a" "b" "c") "]" ())
    ;; 禁止トークンが含まれている
    (("a" "X" "b" "]") "]" ("X"))
    ;; tokens が空
    (() "]" ())
  )
)